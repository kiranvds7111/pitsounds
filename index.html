<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Minecraft 1.8.8 Sound Browser</title>
  <style>
    :root { --bg:#0b0f14; --card:#121820; --fg:#e8eef6; --muted:#9bb0c3; --accent:#6aa6ff; }
    *{box-sizing:border-box}
    body{margin:0;background:var(--bg);color:var(--fg);font:16px/1.4 system-ui,-apple-system,Segoe UI,Roboto,Inter,Arial}
    header{position:sticky;top:0;background:linear-gradient(180deg,rgba(11,15,20,.98),rgba(11,15,20,.9));backdrop-filter:saturate(1.2) blur(8px);z-index:5;border-bottom:1px solid #1f2937}
    .wrap{max-width:1100px;margin:0 auto;padding:16px}
    h1{font-size:20px;margin:0 0 8px 0}
    .row{display:flex;gap:12px;flex-wrap:wrap;align-items:center}
    input[type="search"]{flex:1;min-width:260px;padding:10px 12px;border-radius:12px;background:#0f141b;border:1px solid #1f2633;color:var(--fg)}
    .meta{color:var(--muted);font-size:13px}
    main{max-width:1100px;margin:0 auto;padding:16px}
    .controls{display:flex;gap:10px;align-items:center;margin:8px 0 16px}
    .controls label{font-size:13px;color:var(--muted)}
    .grid{display:grid;grid-template-columns:repeat(1,minmax(0,1fr));gap:10px}
    @media (min-width:800px){.grid{grid-template-columns:repeat(2,minmax(0,1fr))}}
    .card{background:var(--card);border:1px solid #1f2633;border-radius:14px;padding:12px}
    .title{display:flex;align-items:center;justify-content:space-between;gap:8px}
    .title b{font-size:14px}
    .title small{color:var(--muted)}
    .sounds{margin-top:10px;display:flex;flex-direction:column;gap:8px}
    .sound{display:flex;gap:10px;align-items:center}
    button{appearance:none;border:1px solid #1f2633;background:#16202c;color:var(--fg);padding:6px 10px;border-radius:10px;cursor:pointer}
    button:hover{border-color:#2b3a4d}
    .pill{font-size:12px;color:var(--muted);border:1px solid #1f2633;padding:2px 8px;border-radius:999px}
    .hidden{display:none}
    a{color:var(--accent);text-decoration:none}
    footer{padding:24px;color:var(--muted);text-align:center}
  </style>
</head>
<body>
  <header>
    <div class="wrap">
      <h1>ðŸŽ§ Minecraft 1.8.8 Sound Browser</h1>
      <div class="row">
        <input id="search" type="search" placeholder="Search sounds (e.g. note, anvil, ghast, step_wood, pling, portal)â€¦" />
        <span class="meta" id="count">Loadingâ€¦</span>
      </div>
      <div class="controls">
        <label>Volume <input id="vol" type="range" min="0" max="1" value="1" step="0.01"></label>
        <label>Playback rate <input id="rate" type="range" min="0.5" max="2" value="1" step="0.01"></label>
        <span class="pill">Data: 1.8.8 sounds.json</span>
        <a class="pill" target="_blank" rel="noreferrer" href="https://mcasset.cloud/1.8.8/assets/minecraft/sounds.json">view source</a>
      </div>
    </div>
  </header>

  <main>
    <div class="grid" id="grid" aria-live="polite"></div>
  </main>

  <footer>
    Built for Spigot/Bukkit 1.8.8 era. Uses <a target="_blank" rel="noreferrer" href="https://mcasset.cloud/">mcasset.cloud</a> as the CDN for OGG files. Tip: hover a file name to see its direct URL.
  </footer>

  <script>
    // --- Configuration ---
    const VERSION = '1.8.8';
    const JSON_URL = `https://mcasset.cloud/${VERSION}/assets/minecraft/sounds.json`;
    const OGG_BASE = `https://assets.mcasset.cloud/${VERSION}/assets/minecraft/sounds/`;

    const $grid = document.getElementById('grid');
    const $search = document.getElementById('search');
    const $count = document.getElementById('count');
    const $vol = document.getElementById('vol');
    const $rate = document.getElementById('rate');

    // Store <audio> elements per file so we can control volume/rate globally
    const audioMap = new Map();

    function makeCard(eventId, entries) {
      const card = document.createElement('div');
      card.className = 'card';

      const title = document.createElement('div');
      title.className = 'title';
      const left = document.createElement('div');
      const right = document.createElement('div');

      const name = document.createElement('b');
      name.textContent = eventId;
      left.appendChild(name);

      const small = document.createElement('small');
      small.textContent = `${entries.length} file${entries.length>1?'s':''}`;
      right.appendChild(small);

      title.appendChild(left);
      title.appendChild(right);

      const list = document.createElement('div');
      list.className = 'sounds';

      entries.forEach((e, i) => {
        // entries can be strings or objects in sounds.json
        const path = typeof e === 'string' ? e : (e.name || e.sound || e.id || '');
        const full = `${path}.ogg`;
        const url = OGG_BASE + full;

        const row = document.createElement('div');
        row.className = 'sound';

        const btn = document.createElement('button');
        btn.textContent = 'â–¶ Play';
        btn.addEventListener('click', () => {
          play(url, btn);
        });

        const label = document.createElement('code');
        label.textContent = full;
        label.title = url;
        label.style.fontSize = '12px';

        const link = document.createElement('a');
        link.href = url; link.target = '_blank'; link.rel = 'noreferrer';
        link.textContent = 'open';
        link.className = 'pill';

        row.appendChild(btn);
        row.appendChild(label);
        row.appendChild(link);
        list.appendChild(row);

        // Pre-create audio elements for global volume/rate control
        const audio = new Audio(url);
        audio.preload = 'none';
        audio.volume = parseFloat($vol.value);
        audio.playbackRate = parseFloat($rate.value);
        audioMap.set(url, audio);
      });

      card.appendChild(title);
      card.appendChild(list);
      card.dataset.eventId = eventId.toLowerCase();
      card.dataset.files = entries.map(e => (typeof e === 'string' ? e : (e.name || e.sound || e.id || ''))).join(' ').toLowerCase();
      return card;
    }

    function play(url, btn){
      const audio = audioMap.get(url) || new Audio(url);
      audio.volume = parseFloat($vol.value);
      audio.playbackRate = parseFloat($rate.value);
      audio.currentTime = 0;
      audio.play();
      btn.disabled = true;
      const t = setInterval(() => {
        if (audio.paused || audio.ended){
          btn.disabled = false; clearInterval(t);
        }
      }, 100);
    }

    function filterCards(){
      const q = $search.value.trim().toLowerCase();
      let visible = 0;
      for (const card of $grid.children){
        const hay = card.dataset.eventId + ' ' + card.dataset.files;
        const show = !q || hay.includes(q);
        card.classList.toggle('hidden', !show);
        if (show) visible++;
      }
      $count.textContent = `${visible} / ${$grid.children.length} sound events`;
    }

    $search.addEventListener('input', filterCards);
    $vol.addEventListener('input', () => {
      const v = parseFloat($vol.value);
      for (const a of audioMap.values()) a.volume = v;
    });
    $rate.addEventListener('input', () => {
      const r = parseFloat($rate.value);
      for (const a of audioMap.values()) a.playbackRate = r;
    });

    async function init(){
      try{
        const res = await fetch(JSON_URL, { cache: 'force-cache' });
        const data = await res.json();

        const fragments = document.createDocumentFragment();
        const events = Object.keys(data).sort((a,b)=>a.localeCompare(b));
        events.forEach(eventId => {
          const entry = data[eventId];
          let sounds = entry?.sounds || [];
          // Normalise: in 1.8, entries are strings or objects with name/sound
          sounds = sounds.map(s => (typeof s === 'string') ? s : (s.name || s.sound || s.id || s));
          const card = makeCard(eventId, sounds);
          fragments.appendChild(card);
        });
        $grid.appendChild(fragments);
        $count.textContent = `${events.length} sound events loaded`;
      } catch(err){
        console.error(err);
        $count.textContent = 'Failed to load sounds.json';
        const p = document.createElement('p');
        p.textContent = 'Could not fetch the 1.8.8 sound index. Are you offline?';
        document.querySelector('main').appendChild(p);
      }
    }

    init();
  </script>
</body>
</html>
